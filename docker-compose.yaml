version: '2'
services:
  network:
    build: network/
    image: ollebo/yun-network
    network_mode: host
    privileged: true
    environment:
      - WIFI_NAME=CGO3_ROCK4B
      - WIFI_PASSWORD=0123456789
      - WIFI_DEVICE=wlan0
      - IPADDR=192.168.42.1/24        
  dhcpd:
    build: network
    privileged: true
    command:
     - dnsmasq
     - -d  
     - --dhcp-range=192.168.42.10,192.168.42.100
     - --dhcp-option=option:router,192.168.42.1
     - --dhcp-option=6,192.168.42.1,1.1.1.1
     - --log-queries 
     - --log-dhcp
    network_mode: host 
  api:
    build: .
    image: ollebo/yun-api
    volumes:
      - ./:/code
      - ./images:/images
    #command: tail -f /etc/fstab
    network_mode: host
    ports:
      - 8080:8080
    environment:
      - RTSP_STREAM=['rtsp://localhost:554/live']
    depends_on: 
      - ffmpeg
  rtsp:
    build: rtsp/
    image: ollebo/yun-rtsp
    environment:
      - RTSP_API=yes
      - RTSP_APIADDRESS=0.0.0.0:9997
      - RTSP_LOGLEVEL=debug
    network_mode: host
  ffmpeg:
    build: ffmpeg/
    image: ollebo/ffmpeg
    network_mode: host
    privileged: true
    volumes:
      - /dev:/dev
    command: ffmpeg -f v4l2 -i /dev/video5 -framerate 30 -video_size 1920x1088 -f rtsp rtsp://localhost:554/live
    depends_on:
      - rtsp
